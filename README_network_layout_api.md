# ネットワークレイアウトAPI

このAPIは、ネットワークのデータと選択したレイアウトアルゴリズムやパラメーターをもとに、レイアウトが適応されたネットワークデータを返すAPIです。

## 実装内容

1. **フロントエンド（NetworkChatPage.jsx）の拡張**:
   - 日本語のレイアウトコマンドを検出するロジックを追加
   - 「レイアウト」「適応」「変更」「適用」などの日本語キーワードを認識
   - 各レイアウトタイプの日本語名（「円形」「ランダム」「スプリング」など）を認識
   - MCPサーバーが失敗した場合のフォールバックメカニズムを追加

2. **バックエンド（network_chat.py）の拡張**:
   - OpenAIのシステムプロンプトを更新して日本語コマンドをサポート
   - 日本語のレイアウトタイプを検出するロジックを追加

3. **MCPサーバーの初期化改善**:
   - main.pyでMCPサーバーを適切に初期化するコードを追加

## 現在の状態

現在、システムは以下のように動作しています：

1. **MCPサーバー**: 
   - MCPサーバーのエンドポイント（/mcp/tools/change_layout）は404エラーを返しています
   - MCPマニフェスト（/mcp/manifest）も404エラーを返しています

2. **フォールバックメカニズム**:
   - MCPサーバーが失敗した場合、システムは従来のAPI（/network/layout）にフォールバックします
   - このフォールバックメカニズムは正常に動作しており、200 OKレスポンスを返しています

3. **日本語コマンド検出**:
   - フロントエンドとバックエンドの両方で日本語コマンド検出ロジックが実装されています
   - コードテスト（test_japanese_layout_code.py）では、このロジックが正しく動作することが確認されています

## 使用可能なレイアウトアルゴリズム

以下のレイアウトアルゴリズムが使用可能です：

| 英語名 | 日本語名 | 説明 |
|--------|----------|------|
| spring | スプリング | バネモデルを使用したレイアウト |
| circular | 円形 | ノードを円形に配置 |
| random | ランダム | ノードをランダムに配置 |
| spectral | スペクトル | スペクトル分解を使用したレイアウト |
| shell | 殻 | 同心円状にノードを配置 |
| spiral | スパイラル | 螺旋状にノードを配置 |
| kamada_kawai | カマダ・カワイ | Kamada-Kawaiアルゴリズムを使用したレイアウト |
| fruchterman_reingold | フルクターマン・ラインゴールド | Fruchterman-Reingoldアルゴリズムを使用したレイアウト |
| bipartite | 二部 | 二部グラフ用のレイアウト |
| multipartite | 多部 | 多部グラフ用のレイアウト |
| planar | 平面 | 平面グラフ用のレイアウト（平面グラフの場合のみ使用可能） |
| community | コミュニティ | コミュニティ検出に基づくレイアウト |

## 使用例

### APIエンドポイント

```
POST /network/layout
```

### リクエスト本文

```json
{
  "nodes": [
    {"id": "1", "label": "Node 1"},
    {"id": "2", "label": "Node 2"},
    {"id": "3", "label": "Node 3"}
  ],
  "edges": [
    {"source": "1", "target": "2"},
    {"source": "2", "target": "3"},
    {"source": "3", "target": "1"}
  ],
  "layout": "circular",
  "layout_params": {}
}
```

### レスポンス

```json
{
  "nodes": [
    {"id": "1", "label": "Node 1", "x": 1.0, "y": 0.0},
    {"id": "2", "label": "Node 2", "x": -0.5, "y": 0.866},
    {"id": "3", "label": "Node 3", "x": -0.5, "y": -0.866}
  ],
  "edges": [
    {"source": "1", "target": "2"},
    {"source": "2", "target": "3"},
    {"source": "3", "target": "1"}
  ]
}
```

### チャットインターフェイスでの使用例

英語：
```
Change the layout to circular
```

日本語：
```
円形レイアウトに変更してください
```

## 今後の改善点

1. **MCPサーバーの修正**:
   - MCPサーバーの設定を確認し、正しいエンドポイントが公開されているか確認
   - `docker-compose.yml`ファイルでMCPサーバーの設定を確認
   - API/main.pyでのMCPアプリのマウント方法を確認

2. **チャットインターフェイスの改善**:
   - メッセージ送信機能のデバッグ
   - 送信ボタンの追加または既存の送信機能の修正

3. **より自然な日本語表現のサポート**:
   - より多様な日本語表現をサポートするために、検出ロジックを拡張
   - 日本語のエラーメッセージやフィードバックの追加
